{"version":3,"file":"login.js","sourceRoot":"","sources":["../../../src/authentication/login.js"],"names":[],"mappings":"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","sourcesContent":["//import * as msal from '@azure/msal-browser';\n//require (\"https://alcdn.msauth.net/browser/2.13.1/js/msal-browser.min.js\");\n\n// /import { logger } from \"./Shared/Helper\";\n\n$(function(){\n\n    logger.log('Auth now');\n    \n    //logincommon.auth();\n    Office.onReady().then(function(info)\n    {\n        console.log('office context:',Office.context.ui);\n        console.log(info);\n        logger.log(info);\n        logincommon.auth();\n    });\n\n})\n\nvar loginfunctions={};\n\nloginfunctions.loginfn=()=>\n{\n    $('#contentdiv').append(\"<h2>ok</h2>\");\n    $('#contentdiv').append(\"<h2>office ready</h2>\");\n    logincommon.login();\n  \n}\n\n\nloginfunctions.logoutfn=()=>\n{\n    Office.onReady().then(function()\n    {\n         logincommon.logout();\n\n    });\n}\n\nvar logincommon=\n{\n     \n    msalConfig:{\n        auth: {           \n            clientId: '121964d0-6350-438e-b38a-54bfedab82bf',           \n            authority: 'https://login.microsoftonline.com/common',\n          },\n          cache: {\n            cacheLocation: \"localStorage\", // Needed to avoid \"User login is required\" error.\n            storeAuthStateInCookie: true // Recommended to avoid certain IE/Edge issues.\n          }\n    },\n\n    _msalInstance:null,\n    get msalInstance()\n    {\n     if(!logincommon._msalInstance) logincommon._msalInstance=new msal.PublicClientApplication(logincommon.msalConfig);\n     return logincommon._msalInstance;\n    }\n\n\n\n};\n\nlogincommon.msalredirecthander=function(res){\n    \n    console.log(res);\n    const currentAccounts = logincommon.msalInstance.getAllAccounts();\n    if (currentAccounts === null) {\n        logger.log( \"no accounts detected\");\n    }\n    else if (currentAccounts.length > 1) \n    {\n        // Add choose account code here\n        logger.log(\"multiple accounts\");\n    } else if (currentAccounts.length === 1) {\n        username = currentAccounts[0].username;\n        logger.log(\"1 accounts: \"+username);\n    }\n   \n    if(res)\n    {\n        authCallback(null,res);\n    }\n}\n\nlogincommon.login=function()\n{\n    try\n    {\n        $('#contentdiv').append(\"<h2>Tryign login</h2>\");\n        //if(!logincommon.msalInstance) logincommon.msalInstance=new msal.PublicClientApplication(logincommon.msalConfig);\n        var loginRequest = {\n            scopes: [\"User.Read\",\"Sites.ReadWrite.All\",\n             //\"https://graph.microsoft.com/Sites.ReadWrite.All\",\n             //\"https://incitias.sharepoint.com/AllSites.Manage\",\n             //\"https://incitias.sharepoint.com/User.Read.All\"\n             ] // optional Array<string>\n        };\n        logincommon.msalInstance.handleRedirectPromise().then(\n            logincommon.msalredirecthander,\n            function(err){logger.log('logn redirect error: '+JSON.stringify(err));}\n        );\n        logincommon.msalInstance.loginRedirect(loginRequest);\n    }\n    catch(loginerr)\n    {\n        $('#contentdiv').append(\"<h2>Login error: \"+JSON.stringify(loginerr)+\"</h2>\");\n\n        logger.log('Login Error: '+JSON.stringify(loginerr));\n    }\n\n\n}\n\nlogincommon.logout=function()\n{\n    try\n    {\n        //if(!logincommon.msalInstance) logincommon.msalInstance=new msal.PublicClientApplication(logincommon.msalConfig);\n\n        const logoutRequest = {\n            account: logincommon.msalInstance.getAccountByUsername(\"admin@sha2013.onmicrosoft.com\")\n        }\n        \n        logincommon.msalInstance.logout(logoutRequest);\n    }\n    catch(loginerr)\n    {\n        logger.log('Login Error: '+loginerr);\n    }\n}\n\nlogincommon.auth=async function()\n{\n    try\n    {\n        logger.log('Auth now in function');\n\n        var currentAccount;\n        var allacocunts=logincommon.msalInstance.getAllAccounts();//getAccountByUsername(\"admin@sha2013.onmicrosoft.com\");\n        //var currentAccount = logincommon.msalInstance.getAccountByUsername(\"ankur.agarwal@incitias.com\");\n        //logger.log('current account',currentAccount.username);\n        if(allacocunts && allacocunts.length>0) currentAccount=allacocunts[0];\n        else currentAccount=null;\n        console.log(currentAccount);\n        var asyncloginRequest = {\n         scopes: [\n             \"User.Read\",\"Sites.ReadWrite.All\",\n        // \"https://incitias.sharepoint.com/AllSites.Manage\",\n        // \"https://incitias.sharepoint.com/User.Read.All\"\n        ], // optional Array<string>\n         account: currentAccount,\n         //prompt:'consent',\n         forceRefresh: false,\n        };\n \n        var loginRequest = \n        {\n         scopes: [\n             \"User.Read\",\"Sites.ReadWrite.All\",\n            // \"https://incitias.sharepoint.com/AllSites.Manage\",\n         //\"https://incitias.sharepoint.com/User.Read.All\"\n        ],\n         // prompt:'consent',\n\n         //loginHint: currentAccount.username // optional Array<string>\n        };\n        logincommon.msalInstance.handleRedirectPromise().then(\n            logincommon.msalredirecthander,\n            function(err){logger.log('logn redirect error: '+JSON.stringify(err));}\n        );\n        var tksil=await logincommon.msalInstance.acquireTokenSilent(asyncloginRequest).then(function(tokenResponse)\n         {\n         // Do something with the tokenResponse\n           logger.log('got it '+ JSON.stringify(tokenResponse));\n           console.log('got it',tokenResponse);\n           return tokenResponse;\n         }).catch(function(error) \n         {\n             logger.log('err: ',error);\n \n             // if (error instanceof InteractionRequiredAuthError)\n             //  {\n                 // fallback to interaction when silent call fails\n                 return logincommon.msalInstance.acquireTokenRedirect(loginRequest);\n              //}\n         });\n \n         logger.log(JSON.stringify(tksil));\n         console.log('now auth call back',tksil);\n         authCallback(null,tksil);\n    }\n    catch(autherr)\n    {\n        console.log('auth error',autherr);\n\n        logger.log(\"Error in Auth\");\n        logger.log(\"\",autherr);\n    }\n}\n\n\nfunction authCallback(error, response) {\n    console.log('in authcallbacl',response.tokenType);\n    if (error) {\n      logger.log(error);\n      //Office.context.ui.messageParent(JSON.stringify({ status: \"failure\", result: error }));\n    } else {\n      if (response.tokenType === \"id_token\") {\n        logger.log(\"id_token\"+response.idToken.rawIdToken);\n        //localStorage.setItem(\"loggedIn\", \"yes\");\n      } else {\n        logger.log(\"token type is:\" + response.tokenType);\n        console.log('token type is',response.tokenType);\n     \n        Office.onReady().then(info=>\n        {\n            Office.context.ui.messageParent(JSON.stringify({ status: \"success\", result: response.accessToken }));\n\n        });\n      }\n    }\n  }\n\n\nvar logger={};\n\nlogger.log=async (logmsg,logobj)=>\n{  \n    try\n    {\n    //console.log(logmsg,logobj);    \n    if(logobj)logmsg=logmsg+\": \"+JSON.stringify(logobj);\n    // if (Object.prototype.toString.call(logmsg) === '[object Object]')\n    // logmsg=JSON.stringify(logmsg);\n    \n    console.log(logmsg);\n    \n\n    }\n    catch(err){ console.log('eeror in logger',err); }\n\n}\n\n\n"]}